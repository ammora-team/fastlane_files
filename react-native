def react_native_path
  gpg_cmd = `which react-native`

  unless gpg_cmd.empty?
    return 'react-native'
  end

  Dir.chdir ".." do
    if File.file?('./node_modules/.bin/react-native')
      return './node_modules/.bin/react-native'
    end
  end

  return ''
end

lane :requirements do
  is_install = react_native_path

  if (is_install == '')
    UI.user_error!("'react-native' not installed")
  end
end

platform :android do
  override_lane :build_artifact do |options|
    if (options[:env] != 'staging' && options[:env] != 'prod')
      cmd_react_native = react_native_path()
      Dir.chdir ".." do
        sh(
          cmd_react_native,
          "bundle",
          "--platform",
          "android",
          "--dev",
          "false",
          "--entry-file",
          "index.js",
          "--bundle-output",
          "android/app/src/main/assets/index.android.bundle",
          "--verbose"
        )
      end
    end

    options = gradle_artifact(options)
  end
end
